<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sample">
	<select id="getList" parameterType="String" resultType="sample" >
		/* sample.getList */
		SELECT seq, filename, confirmed 
		FROM sample
		WHERE orderid = #{value}
		ORDER BY seq DESC;
	</select>
	
	<select id="getListByItem" parameterType="samplePagable" resultType="sample" >
		/* sample.getListByItem */
		SELECT * 
		FROM sample 
		WHERE item = #{item}
		<if test="lastSeq != null and lastSeq != ''"> 
		AND seq &lt; #{lastSeq}
		</if>
		AND confirmed = 1 
		AND company = #{company}
		ORDER BY seq DESC 
		LIMIT #{pageSize};
	</select>
	
	<insert id="add" parameterType="sample" useGeneratedKeys="true" keyProperty="seq" >
		/* sample.add */
		INSERT INTO sample
		( userid, orderid, item, shape, filename, registered, company )
		VALUES
		(#{userid}, #{orderid}, #{item}, #{shape}, #{fileName}, now(), #{company}) 
	</insert>
	
	<select id="get" parameterType="int" resultType="sample">
		/* sample.get */
		SELECT *
		FROM sample
		WHERE seq = #{value}
	</select>
	
	<update id="removeConfirmFlag" parameterType="int">
		/* sample.removeConfirmFlag */
		UPDATE `sample`
		SET `confirmed` = 0
		WHERE `orderid` = #{value};
	</update>
	
	<update id="updateConfirmFlag" parameterType="String">
		/* sample.updateConfirmFlag */
		UPDATE `sample`
		SET `confirmed` = 1, `company` = #{company}
		WHERE `seq` = #{seq}
	</update>
	
	<delete id="deleteSample" parameterType="int">
		/* sample.deleteSample */
		DELETE FROM `sample`
		WHERE seq = #{value}
	</delete>
	
</mapper>