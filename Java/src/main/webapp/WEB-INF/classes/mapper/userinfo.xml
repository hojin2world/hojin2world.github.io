<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="userinfo">
	<select id="get" parameterType="String" resultType="userinfo">
		/* userinfo.get */
		SELECT USER.`userid`, USER.`username`, USER.`mobile`, USER.`addr`, 
				USER.`email`, USER.`email_allow`, USER.`sms_allow`, USER.`registered`, ROLES.role 
		FROM users USER, user_roles ROLES WHERE USER.`userid` = #{userid} AND USER.userid = ROLES.userid
	</select>
	
	<insert id="submit" parameterType="userinfo">
		/* userinfo.submit */
		INSERT INTO `users`
			(userid, username, passwd, mobile, addr, registered, enabled, email, email_allow, sms_allow)
		VALUES 
			(#{userid}, #{username}, #{passwd}, #{mobile}, #{addr}, now(), #{enabled}, #{email}, #{email_allow}, #{sms_allow})
		ON DUPLICATE KEY UPDATE		 
			<if test="passwd != null and passwd != ''">
			`passwd` = #{passwd},  
			</if>
			`username` = #{username}, `mobile` = #{mobile}, `addr` = #{addr}, `modified` = now(), 
			`email` = #{email}, `email_allow` = #{email_allow}, `sms_allow` = #{sms_allow}		
	</insert>	
	
	
</mapper>